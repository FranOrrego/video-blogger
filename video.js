document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("play-pause-btn"),t=document.getElementById("current-station-name"),n=document.getElementById("video-list"),a=document.querySelector(".video-player-wrapper"),r=document.querySelector(".video-controls-bar"),i=a.querySelector(".initial-message"),s={ACTIVE:"active",PLAYING:"true",ERROR:"error",LOADING:"loading",EMPTY:"empty",INITIAL_MESSAGE_VISIBLE:"initial-message-visible"};let o=null,l=[];const d="function"==typeof videojs?videojs("my-video"):null;if(!d)return console.error("Video.js no está disponible. Asegúrate de que el script se cargue correctamente."),t.textContent="Error: Reproductor no disponible.",void(e&&(e.disabled=!0));function c({loading:c=!1,playing:u=!1,error:v=!1}){r.classList.toggle(s.LOADING,c),r.classList.toggle(s.PLAYING,u),r.classList.toggle(s.ERROR,v),e.disabled=c,e.setAttribute("aria-label",u?"Pausar Video":"Reproducir Video"),e.setAttribute("aria-pressed",u.toString())}function u(){document.querySelectorAll(".video-list li").forEach(e=>{e.classList.remove(s.ACTIVE),e.setAttribute("aria-selected","false")})}function v(){const e=d.error();console.error("Error de Video.js:",e,o),c({error:!0,playing:!1,loading:!1}),t.textContent=`Error: ${e?e.message||"Error desconocido":"Error de reproducción"} (${o?.name||"video"})`,d.poster(""),a.classList.add(s.EMPTY),i.textContent="Error al cargar el video. Intenta otro.",i.classList.add(s.INITIAL_MESSAGE_VISIBLE)}d.on("play",()=>c({playing:!0,loading:!1,error:!1})),d.on("pause",()=>c({playing:!1,loading:!1,error:!1})),d.on("ended",()=>{c({playing:!1,loading:!1,error:!1}),o&&(t.textContent=`Fin de ${o.name}`)}),d.on("waiting",()=>c({loading:!0,playing:!d.paused(),error:!1})),d.on("playing",()=>c({playing:!0,loading:!1,error:!1})),d.on("error",v);function m(n,a){if(o?.src===n.src&&d.paused())return void d.play().catch(r=>{console.warn("Fallo al intentar reproducir (posible autoplay bloqueado):",r),c({loading:!1,playing:!1,error:!1}),t.textContent=`Haz clic en Reproducir: ${n.name}`});u(),a.classList.add(s.ACTIVE),a.setAttribute("aria-selected","true"),o=n,c({loading:!0,playing:!1,error:!1}),t.textContent=`Cargando: ${n.name}...`,a.classList.remove(s.EMPTY),i.classList.remove(s.INITIAL_MESSAGE_VISIBLE),d.src({src:n.src,type:n.type}),d.poster(n.poster||""),d.load(),d.ready(()=>{d.play().catch(a=>{console.warn("No se pudo iniciar la reproducción automáticamente:",a),c({loading:!1,playing:!1,error:!1}),t.textContent=`Presiona reproducir para ${n.name}`})}),d.one("loadedmetadata",()=>{!d.error()&&o===n&&(t.textContent=n.name)})}async function y(){try{const e=await fetch("videos.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);if(l=await e.json(),l&&l.length>0){const e=document.createDocumentFragment();l.forEach((t,n)=>{const a=document.createElement("li");a.textContent=t.name,a.dataset.index=n,a.tabIndex=0,a.setAttribute("role","option"),a.setAttribute("aria-selected","false"),e.appendChild(a)}),n.innerHTML="",n.appendChild(e),i.textContent="Selecciona un video para comenzar",i.classList.add(s.INITIAL_MESSAGE_VISIBLE),t.textContent="Selecciona un video",e.disabled=!1}else i.textContent="No hay videos disponibles.",i.classList.add(s.INITIAL_MESSAGE_VISIBLE),e.disabled=!0,t.textContent="Lista vacía",n.innerHTML="<li>No videos found.</li>"}catch(a){console.error("Error al cargar la lista de videos:",a),i.textContent="Error al cargar los videos. Intenta recargar.",i.classList.add(s.INITIAL_MESSAGE_VISIBLE),e.disabled=!0,t.textContent="Error de carga",n.innerHTML="<li>Error al cargar videos.</li>"}}n.addEventListener("click",e=>{const t=e.target.closest("li[data-index]");if(t){const e=parseInt(t.dataset.index,10);!isNaN(e)&&l[e]&&m(l[e],t)}}),n.addEventListener("keydown",e=>{const r=document.activeElement;if(r&&r.parentNode===n&&"LI"===r.tagName){const i=parseInt(r.dataset.index,10);let s=null;"ArrowDown"===e.key?(e.preventDefault(),s=n.querySelector(`li[data-index="${i+1}"]`)):"ArrowUp"===e.key?(e.preventDefault(),s=n.querySelector(`li[data-index="${i-1}"]`)):"Home"===e.key?(e.preventDefault(),s=n.firstElementChild):"End"===e.key?(e.preventDefault(),s=n.lastElementChild):("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),!isNaN(i)&&l[i]&&m(l[i],r)));s&&s.focus()}}),e.addEventListener("click",()=>{if(!o&&l.length>0){const n=n.querySelector(`li[data-index="0"]`);if(n){const a=parseInt(n.dataset.index,10);return void(!isNaN(a)&&l[a]&&m(l[a],n))}return t.textContent="No se pudo encontrar el primer video.",void c({loading:!1,playing:!1,error:!0})}if(0===l.length)return t.textContent="No hay videos disponibles.",void c({loading:!1,playing:!1,error:!0});d.paused()?d.play().catch(n=>{console.warn("Fallo al intentar reproducir (posible autoplay bloqueado):",n),c({loading:!1,playing:!1,error:!1}),t.textContent=`Haz clic para reproducir: ${o.name}`}):d.pause()}),y()});
